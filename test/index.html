<!DOCTYPE html>

<title>Ari-TR tests</title>
<meta charset="utf-8">
<link rel="stylesheet" href="qunit/qunit/qunit.css">

<h1 id="qunit-header">Ari-TR tests</h1>
<h2 id="qunit-banner"></h2>
<div id="qunit-testrunner-toolbar"></div>
<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>

<script src="qunit/qunit/qunit.js"></script>
<script src="../src/BigInt.js"></script>
<script src="../src/mootools.js"></script>
<script src="../src/Calculator.js"></script>
<script src="../src/Term.js"></script>

<script>
module("Calculator");

test("wrong inputs", function() {
	var first = str2bigInt("first", 36);
	var second = str2bigInt("second", 36);
	
	ok(!Calculator.calculate("+", null, second), "no first");
	ok(!Calculator.calculate("+", first), "no second");
	ok(!Calculator.calculate("#", first, second), "wrong operator");
});

test("+", function() {
	var zero = str2bigInt("0", 10);
	var one = str2bigInt("1", 10);
	var two = str2bigInt("2", 10);
	var three = str2bigInt("3", 10);
	
	var minusone = str2bigInt("1", 10);
	minusone.negative = true;
	
	var minustwo = str2bigInt("2", 10);
	minustwo.negative = true;
	
	var minusthree = str2bigInt("3", 10);
	minusthree.negative = true;

	deepEqual(Calculator.calculate("+", one, one), two, "1 + 1 = 2");
	deepEqual(Calculator.calculate("+", one, two), three, "1 + 2 = 3");
	deepEqual(Calculator.calculate("+", zero, zero), zero, "0 + 0 = 0");
	deepEqual(Calculator.calculate("+", zero, two), two, "0 + 2 = 2");
	deepEqual(Calculator.calculate("+", two, zero), two, "2 + 0 = 2");
	deepEqual(Calculator.calculate("+", two, minusone), one, "2 + (-1) = 1");
	deepEqual(Calculator.calculate("+", one, minustwo), minusone, "1 + (-2) = (-1)");
	deepEqual(Calculator.calculate("+", minusone, one), zero, "(-1) + 1 = 0");
	deepEqual(Calculator.calculate("+", minustwo, three), one, "(-2) + 3 = 1");
	deepEqual(Calculator.calculate("+", one, minusone), zero, "1 + (-1) = 0");
	deepEqual(Calculator.calculate("+", minustwo, one), minusone, "(-2) + 1 = (-1)");
	deepEqual(Calculator.calculate("+", minusone, minustwo), minusthree, "(-1) + (-2) = (-3)");
});

test("-", function() {
	var zero = str2bigInt("0", 10);
	var one = str2bigInt("1", 10);
	var two = str2bigInt("2", 10);
	var three = str2bigInt("3", 10);
	
	var minusone = str2bigInt("1", 10);
	minusone.negative = true;
	
	var minustwo = str2bigInt("2", 10);
	minustwo.negative = true;
	
	var minusthree = str2bigInt("3", 10);
	minusthree.negative = true;

	deepEqual(Calculator.calculate("-", one, one), zero, "1 - 1 = 0");
	deepEqual(Calculator.calculate("-", three, one), two, "3 - 1 = 2");
	deepEqual(Calculator.calculate("-", one, three), minustwo, "1 - 3 = (-2)");
	deepEqual(Calculator.calculate("-", zero, zero), zero, "0 - 0 = 0");
	deepEqual(Calculator.calculate("-", zero, two), minustwo, "0 - 2 = (-2)");
	deepEqual(Calculator.calculate("-", two, zero), two, "2 - 0 = 2");
	deepEqual(Calculator.calculate("-", two, minusone), three, "2 - (-1) = 3");
	deepEqual(Calculator.calculate("-", minusone, one), minustwo, "(-1) - 1 = (-2)");
	deepEqual(Calculator.calculate("-", minusone, minusone), zero, "(-1) - (-1) = 0");
	deepEqual(Calculator.calculate("-", minusthree, minustwo), minusone, "(-3) - (-2) = (-1)");
	deepEqual(Calculator.calculate("-", minustwo, minusthree), one, "(-3) - (-2) = (-1)");
});

module("Term");

test("isValid()", function() {
	// TODO merge tests from isValid() and Term.pattern, more edge cases
	
	var t = new Term("");
	ok(t.isValid(), "empty string");
	
	t = new Term("1");
	ok(t.isValid(), "1");
	
	t = new Term("2+5-3-az+abcdefghijklmnopqrstuvwxyz-0z1ABCDEFGHIJKLMNOPQRSTUVWXYZ");
	ok(t.isValid(), "long case changing string");
	
	t = new Term("0zA");
	ok(t.isValid(), "0zA");
	
	t = new Term("0z");
	ok(t.isValid(), "0z");
	
	t = new Term("0u");
	ok(t.isValid(), "0u");
	
	t = new Term("1#2");
	ok(!t.isValid(), "1#2");
	
	t = new Term("1+");
	ok(t.isValid(), "1+ (still typing)");
	
	t = new Term("1++2");
	ok(!t.isValid(), "1++2");
	
	t = new Term("1-+2");
	ok(!t.isValid(), "1-+2");
	
	t = new Term("hello+this-is- ");
	ok(t.isValid(), "hello+this-is-[space] (still typing)");
});

test("Term.pattern", function() {
	ok(Term.pattern, "pattern defined");
	
	ok(RegExp("^" + Term.pattern + "$"), "pattern valid RegExp");
	ok(RegExp("^" + Term.pattern + "$").test("ABCDE0FGHIJ1KLMNO2PQRS3TU4VW5XY6Z+0zab7cdefg8hijklmnop9qrstuvwxyz-0+"), "working pattern");
	ok(RegExp("^" + Term.pattern + "$").test(""), "working pattern for empty string");
	ok(!RegExp("^" + Term.pattern + "$").test("ab#23"), "invalid chars");
	ok(!RegExp("^" + Term.pattern + "$").test("a++2"), "plus plus");
	ok(!RegExp("^" + Term.pattern + "$").test("a+-2"), "plus minus");
	ok(!RegExp("^" + Term.pattern + "$").test("a-+2"), "minus plus");
	ok(!RegExp("^" + Term.pattern + "$").test("a--2"), "minus minus");
	ok(!RegExp("^" + Term.pattern + "$").test("-2"), "start with minus");
	ok(!RegExp("^" + Term.pattern + "$").test("+2"), "start with plus");
	ok(!RegExp("^" + Term.pattern + "$").test(" +2"), "start with space and plus");
	ok(RegExp("^" + Term.pattern + "$").test("2+"), "end with plus (still typing)");
	ok(RegExp("^" + Term.pattern + "$").test("2+ "), "end with plus and space (still typing)");
	ok(RegExp("^" + Term.pattern + "$").test("2 + "), "end with space, plus and space (still typing)");
});

test("calculate()", function() {
	var t = new Term("$");
	ok(!t.calculate(), "false value for invalid term");
	
	t = new Term("");
	strictEqual(t.calculate(), "0", "0 for empty string");
	
	t = new Term("1+1");
	strictEqual(t.calculate(), "2", "1+1");
	
	t = new Term("1+1-5+2+3-9+A-3-1-1");
	strictEqual(t.calculate(), "-2", "longer string");
	
	t = new Term("0+1+1-3+1-0");
	strictEqual(t.calculate(), "0", "result zero");
	
	t = new Term("   0 +1+1 -3+ 1 -0  ");
	strictEqual(t.calculate(), "0", "ignore spaces");
	
	t = new Term("1 000 + 1 000 000 - 2");
	strictEqual(t.calculate(), "1000ZZY", "ignore spaces inside numbers, result with capital letters");
});

test("calculate() bases", function() {
	var t = new Term("10");
	deepEqual(t.calculate(), "10", "implizit 0z");
	
	t = new Term("0z10");
	deepEqual(t.calculate(), "10", "0z");
	
	t= new Term("0x10");
	deepEqual(t.calculate(), "G", "0x");
	
	t = new Term("0m10");
	deepEqual(t.calculate(), "A", "0m");
	
	t = new Term("0o10");
	deepEqual(t.calculate(), "8", "0o");
	
	t = new Term("0b10");
	deepEqual(t.calculate(), "2", "0b");
	
	t = new Term("0aa");
	deepEqual(t.calculate(), "AA", "no base but prefixed with 0");
});

test("getHtml", function() {
	var t = new Term("4##3");
	ok(!t.getHtml(), "false value for invalid term");
	// TODO
});
</script>