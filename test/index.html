<!DOCTYPE html>

<title>Ari-TR tests</title>
<meta charset="utf-8">
<link rel="stylesheet" href="qunit/qunit/qunit.css">

<h1 id="qunit-header">Ari-TR tests</h1>
<h2 id="qunit-banner"></h2>
<div id="qunit-testrunner-toolbar"></div>
<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>

<script src="qunit/qunit/qunit.js"></script>
<script src="../src/BigInt.js"></script>
<script src="../src/mootools.js"></script>
<script src="../src/TermElement.js"></script>
<script src="../src/Term.js"></script>

<script>
module("TermElement");

test("test initialize and getters", function() {
	var first = str2bigInt("first", 36);
	var second = str2bigInt("second", 36);
	
	var t1 = new TermElement(first, "+", second);
	deepEqual(t1.getFirst(), first, "first as bigint");
	strictEqual(t1.getOperator(), "+", "operator");
	deepEqual(t1.getSecond(), second, "second as bigint");
	
	var t2 = new TermElement("first", "-", "second");
	deepEqual(t2.getFirst(), first, "first as string");
	deepEqual(t2.getSecond(), second, "second as string");
	
	var t3 = new TermElement(t1, "-", t2);
	deepEqual(t3.getFirst(), t1, "first TermElement");
	deepEqual(t3.getSecond(), t2, "second TermElement");
	
	var t4 = new TermElement("in#valid", "$", "str!ngs");
	ok(!t4.getFirst(), "invalid first as string");
	ok(!t4.getOperator(), "invalid operator");
	ok(!t4.getSecond(), "invalid second as string");
	
	var t5 = new TermElement({}, "+", {});
	ok(!t5.getFirst(), "invalid first as object");
	ok(!t5.getSecond(), "invalid second as object");
});

test("test setters and getters", function() {
	var one = str2bigInt("one", 36);
	var two = str2bigInt("two", 36);
	
	var t1 = new TermElement();
	deepEqual(t1.setFirst(one), one, "set first as bigint");
	deepEqual(t1.getFirst(), one, "get first as bigint");
	strictEqual(t1.setOperator("+"), "+", "set operator");
	strictEqual(t1.getOperator(), "+", "get operator");
	deepEqual(t1.setSecond(two), two, "set second as bigint");
	deepEqual(t1.getSecond(), two, "get second as bigint");
	
	var t2 = new TermElement();
	deepEqual(t1.setFirst("one"), one, "set first as string");
	deepEqual(t1.getFirst(), one, "get first as string");
	deepEqual(t1.setSecond("two"), two, "set second as string");
	deepEqual(t1.getSecond(), two, "get second as string");
	
	var t3 = new TermElement();
	deepEqual(t3.setFirst(t1), t1, "set first TermElement");
	deepEqual(t3.getFirst(), t1, "get first TermElement");
	deepEqual(t3.setSecond(t2), t2, "set second TermElement");
	deepEqual(t3.getSecond(), t2, "get second TermElement");
	
	var t4 = new TermElement();
	ok(!t4.setFirst("f√§lse"), "set invalid first as string");
	ok(!t4.getFirst(), "get invalid first as string");
	ok(!t4.setOperator(""), "set invalid operator");
	ok(!t4.getOperator(), "get invalid operator");
	ok(!t4.setSecond("not_ok"), "set invalid second as string");
	ok(!t4.getSecond(), "get invalid second as string");
	
	var t5 = new TermElement();
	ok(!t5.setFirst({}), "set invalid first as object");
	ok(!t5.getFirst(), "get invalid first as object");
	ok(!t5.getSecond({}), "set invalid second as object");
	ok(!t5.getSecond(), "get invalid second as object");
});

test("bases", function() {
	var ten = str2bigInt("10", 10);
	
	var t = new TermElement("a");
	deepEqual(t.getFirst(), ten, "implizit 0z");
	deepEqual(t.setFirst("0za"), ten, "0z");
	deepEqual(t.setFirst("0xa"), ten, "0x");
	deepEqual(t.setFirst("0m10"), ten, "0m");
	deepEqual(t.setFirst("0o12"), ten, "0o");
	deepEqual(t.setFirst("0b1010"), ten, "0b");
	deepEqual(t.setFirst("0a"), ten, "no base but prefixed with 0");
});

test("calculateBigInt() aborts", function() {
	var t1 = new TermElement(null, "+", "one");
	ok(!t1.calculateBigInt(), "no first");
	
	var t2 = new TermElement("one", null, "two");
	ok(!t2.calculateBigInt(), "no operator but second");
	
	var t3 = new TermElement("one", "+");
	ok(!t3.calculateBigInt(), "operator but no second");
});

test("calculateBigInt() positive", function() {
	var one = str2bigInt("1", 10);
	var two = str2bigInt("2", 10);
	var three = str2bigInt("3", 10);
	
	var t1 = new TermElement("2");
	deepEqual(t1.calculateBigInt(), two, "first as string only");
	t1.setFirst(one);
	deepEqual(t1.calculateBigInt(), one, "first as bigint only");
	t1.setFirst(new TermElement(two));
	deepEqual(t1.calculateBigInt(), two, "first as TermElement only");
	
	var t2 = new TermElement("0", "+", "1");
	deepEqual(t2.calculateBigInt(), one, "add two strings");
	t2.setFirst(one);
	deepEqual(t2.calculateBigInt(), two, "add bigint and string");
	t2.setFirst(new TermElement(two));
	deepEqual(t2.calculateBigInt(), three, "add TermElement and string");
	
	var t3 = new TermElement(new TermElement(two), new TermElement(one));
	deepEqual(t3.calculateBigInt(), three, "add two TermElements")
	
	var t4 = new TermElement("4", "-", "3");
	deepEqual(t4.calculateBigInt(), one, "substract two strings");
	t4.setSecond(two);
	deepEqual(t4.calculateBigInt(), two, "substract string and bigint");
	t4.setSecond(new TermElement("1"), three, "substract string and TermElement");
});

test("calculateBigInt() TermElement chains", function() {
	var t = new TermElement(
		new TermElement(
			new TermElement("2", "+", "2"), // = 4
			"-",
			new TermElement("3", "-", "1") // = 2
		), // = 2
		"-",
		new TermElement(
			"0",
			"+",
			new TermElement("6", "-", "5") // = 1
		) // = 1
	); // = 1
	deepEqual(t.calculateBigInt(), str2bigInt("1", 8), "TermElement chain");
});

test("calculateBigInt() negative", function() {
	var one = str2bigInt("1", 10);
	var two = str2bigInt("2", 10);
	var minusone = new TermElement(one, "-", two);
	var minustwo = new TermElement("0", "-", two);
	var minusthree = new TermElement(minustwo, "-", "1");
	
	var t1 = new TermElement(minusone, "+", "0");
	deepEqual(t1.calculateBigInt(), minusone, "(-1) + 0");
	t1.setSecond(minustwo);
	deepEqual(t1.calculateBigInt(), minusthree, "(-1) + (-2)");
	t1.setSecond(new TermElement(one));
	deepEqual(t1.calculateBigInt(), minusone, "1 + (-2)");
	t1.setFirst("0");
	deepEqual(t1.calculateBigInt(), minustwo, "0 + (-2)");
	
	var t2 = new TermElement("0", "-", "1");
	deepEqual(t2.calculateBigInt(), minusone, "0 - 1");
	t2.setFirst(minusone);
	deepEqual(t2.calculateBigInt(), minustwo, "(-1) - 1");
	t2.setSecond(new TermElement(minustwo));
	deepEqual(t2.calculateBigInt(), one, "(-1) - (-2)");
	t2.setFirst("1");
	deepEqual(t2.calculateBigInt(), minusone, "1 - (-2)");
	
	var t3 = new TermElement(
		new TermElement("0", "-", "1"), // -1
		"-",
		new TermElement(
			new TermElement("1", "-", "3"), // -2
			"+",
			new TermElement("3")
		) // 1
	); // -2
	deepEqual(t3.calculateBigInt(), minustwo, "chained");
});

test("calculate()", function() {
	var t1 = new TermElement("1", "+", "1");
	strictEqual(t1.calculate(), "2", "1 + 1 = 2");
	t1.setSecond(new TermElement("1", "-", "4")); // -3
	strictEqual(t1.calculate(), "-2", "1 + (-3) = (-2)");
	t1.setOperator("-");
	strictEqual(t1.calculate(), "4", "1 - (-3) = 4");
	strictEqual(t1.calculate(2), "100", "binary");
	strictEqual(t1.calculate(4), "10", "base 4");
	
	var t2 = new TermElement("1", "-", "1");
	strictEqual(t2.calculate(), "0", "zero");
});

module("Term");

test("isValid()", function() {
	var t0 = new Term("");
	ok(t0.isValid(), "empty string");
	var t1 = new Term("1");
	ok(t1.isValid(), "1");
	var t2 = new Term("2+5-3-az+abcdefghijklmnopqrstuvwxyz-0z1ABCDEFGHIJKLMNOPQRSTUVWXYZ");
	ok(t2.isValid(), "long case changing string");
	var t3 = new Term("1#2");
	ok(!t3.isValid(), "1#2");
	var t4 = new Term("1+");
	ok(t4.isValid(), "1+ (still typing)");
	var t5 = new Term("1++2");
	ok(!t5.isValid(), "1++2");
	var t6 = new Term("1-+2");
	ok(!t6.isValid(), "1-+2");
	var t7 = new Term("hello+this-is-");
	ok(t7.isValid(), "hello+this-is- (still typing)");
});

test("Term.pattern", function() {
	ok(Term.pattern, "pattern defined");
	ok(RegExp("^" + Term.pattern + "$"), "pattern valid RegExp");
	ok(RegExp("^" + Term.pattern + "$").test("ABCDE0FGHIJ1KLMNO2PQRS3TU4VW5XY6Z+0zab7cdefg8hijklmnop9qrstuvwxyz-0+"), "working pattern");
	ok(RegExp("^" + Term.pattern + "$").test(""), "working pattern for empty string");
});

test("calculate()", function() {
	var t0 = new Term("$");
	ok(!t0, "false value for invalid term");
	var t1 = new Term("");
	strictEqual(t1.calculate(), "0", "0 for empty string");
	var t2 = new Term("1+1");
	strictEqual(t2.calculate(), "2", "1+1");
	var t3 = new Term("1+1-5+2-9+A-3");
	strictEqual(t3.calculate(), "-3", "longer string");
	var t4 = new Term("0m36");
	strictEqual(t4.calculate(), "10", "result with base 36");
	var t5 = new Term("1 000 + 1 000 000 - 2");
	strictEqual(t5.calculate(), "1000ZZY", "ignore spaces, capital letters");
});

test("getHtml", function() {
	var t0 = new Term("4##3");
	ok(!t0, "false value for invalid term");
	// TODO
});
</script>